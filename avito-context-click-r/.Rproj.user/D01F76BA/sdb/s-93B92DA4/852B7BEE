{
    "contents" : "load(fn.rdata.file(\"data.reduced.all.RData\"))\nflist <- setdiff(colnames(data.reduced.all), c(\"SearchType\", \"SearchDayYear\"))\n\nwrite.table(as.data.frame(data.reduced.all[SearchType==1][,flist,with=F]),\n            file = fn.out.file(\"train.xgb.csv\"),\n            quote = F,\n            sep = \",\",\n            row.names = F,\n            col.names = T)\n\nwrite.table(as.data.frame(data.reduced.all[SearchType==2][,flist,with=F]),\n            file = fn.out.file(\"val.xgb.csv\"),\n            quote = F,\n            sep = \",\",\n            row.names = F,\n            col.names = T)\n\nwrite.table(as.data.frame(data.reduced.all[SearchType==3][,flist,with=F]),\n            file = fn.out.file(\"test.xgb.csv\"),\n            quote = F,\n            sep = \",\",\n            row.names = F,\n            col.names = T)\n\nwrite.table(as.data.frame(data.reduced.all[SearchType==1 | SearchType==2][,flist,with=F]),\n            file = fn.out.file(\"train.val.xgb.csv\"),\n            quote = F,\n            sep = \",\",\n            row.names = F,\n            col.names = T)\n\nn <- nrow(data.reduced.all[SearchType==1])\nset.seed(23243)\nix.train <- sample(c(1:n), 0.2*n)\nn <- nrow(data.reduced.all[SearchType==2])\nset.seed(102903)\nix.val <- sample(c(1:n), 0.2*n)\n\nwrite.table(as.data.frame(data.reduced.all[SearchType==1][ix.train][,flist,with=F]),\n            file = fn.out.file(\"train.part.xgb.csv\"),\n            quote = F,\n            sep = \",\",\n            row.names = F,\n            col.names = T)\n\nwrite.table(as.data.frame(data.reduced.all[SearchType==2][ix.val][,flist,with=F]),\n            file = fn.out.file(\"val.part.xgb.csv\"),\n            quote = F,\n            sep = \",\",\n            row.names = F,\n            col.names = T)\nval.part.actual <- data.reduced.all[SearchType==2][ix.val][,list(ID,IsClick)]\nsetkey(val.part.actual, ID)\nrm(data.reduced.all)\ngc()\n\n\n### lb part ###\nsystem(paste(\"cd ../avito-context-click-py && python train_xgb_dtry.py\",\n             \"--train\", fn.out.file(\"train.val.xgb.csv\"),\n             \"--test\", fn.out.file(\"test.xgb.csv\"),\n             \"--pred\", fn.py.file(\"test.pred.xgb.csv\"),\n             \"--epoch\", 15,\n             \">> ../data/log/xgb.dtry.log 2>&1\"))  \n\ntest.pred <- list()\nfor (i in c(0:14)) {\n  test.pred[[length(test.pred)+1]] <- fread(fn.py.file(paste0(\"test.pred.xgb.epoch\",i,\".csv\")))\n  cat(mean(test.pred[[length(test.pred)]]$IsClick), \"...\\n\")\n}\ntest.pred <- rbindlist(test.pred, use.names=T, fill=F)\ntest.pred <- test.pred[,list(IsClick = round(mean(IsClick), 6)), by=\"ID\"]\n\nwrite.table(as.data.frame(test.pred),\n            file = fn.submission.file(\"dtry.xgb9__0.0409xx\"),\n            quote = F,\n            sep = \",\",\n            row.names = F,\n            col.names = T)\n\n\n### cv part ###\n#system(paste(\"cd ../avito-context-click-py && python train_xgb_dtry.py\",\n#             \"--train\", fn.out.file(\"train.part.xgb.csv\"),\n#             \"--test\", fn.out.file(\"val.part.xgb.csv\"),\n#             \"--pred\", fn.py.file(\"val.part.pred.xgb.csv\"),\n#             \"--epoch\", 15,\n#             \">> ../data/log/xgb.dtry.log 2>&1\"))  \n\n#val.part.pred <- list()\n#for (i in c(0:4)) {\n#  val.part.pred[[length(val.part.pred)+1]] <- fread(fn.py.file(paste0(\"val.part.pred.xgb.epoch\",i,\".csv\")))\n#  cat(mean(val.part.pred[[length(val.part.pred)]]$IsClick), \"...\\n\")\n#}\n#val.part.pred <- rbindlist(val.part.pred, use.names=T, fill=F)\n#val.part.pred <- val.part.pred[,list(IsClick = round(mean(IsClick), 6)), by=\"ID\"]\n#setkey(val.part.pred, ID)\n#fn.logloss(val.part.actual$IsClick, val.part.pred$IsClick)\n",
    "created" : 1439671804891.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "61486222",
    "id" : "852B7BEE",
    "lastKnownWriteTime" : 1439586086,
    "path" : "~/Documents/eclipse/AvitoContext2015/final_model/avito-context-click-r/train.xgb.dtry.R",
    "project_path" : "train.xgb.dtry.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}